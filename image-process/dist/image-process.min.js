/*!
 * image-process v0.0.2
 * (c) 2017-2017 dailc
 * Released under the MIT License.
 * https://github.com/dailc/image-process
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.ImageProcess=i()}(this,function(){"use strict";function t(t){for(var i=t,e=arguments.length,s=Array(e>1?e-1:0),a=1;a<e;a++)s[a-1]=arguments[a];return s.forEach(function(t){t&&Object.keys(t).forEach(function(e){i[e]=t[e]})}),i}function i(t,i){return function(t,i,e,s,a,h){for(var n=a/i,o=h/e,c=s,r=function(s,h){var r=Math.min(i-1,s/n),l=Math.min(e-1,h/o),v=Math.floor(r),u=Math.floor(l),d=h*a+s,g=u*i+v;d*=4,g*=4;for(var f=0;f<=3;f+=1)c[d+f]=t[g+f]},l=0;l<a;l+=1)for(var v=0;v<h;v+=1)r(l,v)}(t.data,t.width,t.height,i.data,i.width,i.height),i}function e(t,i,e,s,a){var h=s,n=a;h>=e?h=e-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var o=h*i+n;return o*=4,[t[o+0],t[o+1],t[o+2],t[o+3]]}function s(t,i){return function(t,i,s,a,h,n){for(var o=h/i,c=n/s,r=a,l=function(a,n){var l=Math.min(i-1,a/o),v=Math.min(s-1,n/c),u=Math.floor(l),d=Math.floor(v),g=l-u,f=v-d,p=1-g,m=1-f,w=n*h+a;w*=4;for(var R=e(t,i,s,d+0,u+0),x=e(t,i,s,d+0,u+1),M=e(t,i,s,d+1,u+0),F=e(t,i,s,d+1,u+1),S=0;S<=3;S+=1){var T=f*(p*M[S]+g*F[S]),y=m*(p*R[S]+g*x[S]);r[w+S]=T+y}},v=0;v<h;v+=1)for(var u=0;u<n;u+=1)l(v,u)}(t.data,t.width,t.height,i.data,i.width,i.height),i}function a(t,i){return function(t,i,e,s,a,h){for(var n=s,o=a/i,c=h/e,r=function(s,h){var r=Math.min(i-1,s/o),l=Math.min(e-1,h/c),v=Math.floor(r),u=Math.floor(l),d=r-v,g=l-u,f=h*a+s;f*=4;for(var p=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],m=0;m<=3;m+=1){for(var w=-1;w<=2;w+=1)for(var R=-1;R<=2;R+=1)p[w+1][R+1]=E(t,i,e,u+w,v+R,m);k(p),n[f+m]=C(P(g,d))}},l=0;l<a;l+=1)for(var v=0;v<h;v+=1)r(l,v)}(t.data,t.width,t.height,i.data,i.width,i.height),i}function h(t){var i=t>=0?t:-t,e=t*t,s=i*e;return i<=1?1-(X+3)*e+(X+2)*s:i<=2?-4*X+8*X*i-5*X*e+X*s:0}function n(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)}function o(t,i,e,s,a){var h=s,n=a;h>=e?h=e-1:h<0&&(h=0),n>=i?n=i-1:n<0&&(n=0);var o=h*i+n;return o*=4,[t[o+0],t[o+1],t[o+2],t[o+3]]}function c(t,i){return function(t,i,e,s,a,c){for(var r=s,l=a/i,v=c/e,u=function(s,c){var u=Math.min(i-1,s/l),d=Math.min(e-1,c/v),g=Math.floor(u),f=Math.floor(d),p=u-g,m=d-f,w=c*a+s;w*=4;for(var R=[0,0,0,0],x=-1;x<=2;x+=1)for(var M=-1;M<=2;M+=1){var F=o(t,i,e,f+x,g+M),S=h(x-m)*h(M-p);R[0]+=F[0]*S,R[1]+=F[1]*S,R[2]+=F[2]*S,R[3]+=F[3]*S}r[w+0]=n(R[0]),r[w+1]=n(R[1]),r[w+2]=n(R[2]),r[w+3]=n(R[3])},d=0;d<a;d+=1)for(var g=0;g<c;g+=1)u(d,g)}(t.data,t.width,t.height,i.data,i.width,i.height),i}var r=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}(),l={container:"#imgclip",img:null,isSmooth:!0,captureRadius:30,minMoveDiff:1,quality:.92,mime:"image/jpeg",maxCssHeight:0,sizeTipsStyle:0,compressScaleRatio:1,iphoneFixedRatio:2,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},v=function(){function i(e){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i),function(t){(function(t){this.os={};var i=t.match(/(Android);?[\s/]+([\d.]+)?/);i&&(this.os.android=!0,this.os.version=i[2],this.os.isBadAndroid=!/Chrome\/\d/.test(window.navigator.appVersion));var e=t.match(/(iPhone\sOS)\s([\d_]+)/);e&&(this.os.ios=!0,this.os.iphone=!0,this.os.version=e[2].replace(/_/g,"."));var s=t.match(/(iPad).*OS\s([\d_]+)/);s&&(this.os.ios=!0,this.os.ipad=!0,this.os.version=s[2].replace(/_/g,"."));var a=t.match(/QuickHybrid/i);a&&(this.os.quick=!0);var h=t.match(/EpointEJS/i);h&&(this.os.ejs=!0);var n=t.match(/DingTalk/i);n&&(this.os.dd=!0),h||n||a||(this.os.h5=!0)}).call(t,navigator.userAgent)}(this),this.options=t({},l,e),this.container=function(t){var i=t;return"string"==typeof i&&(i=document.querySelector(i)),i}(this.options.container),this.img=this.options.img,this.domChildren=[],this.events={},this.initCanvas(),this.initClip(),this.initMagnifier(),this.initTransferCanvas(),this.resetClipRect()}return r(i,[{key:"getPixelRatio",value:function(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,e=(window.devicePixelRatio||1)/i;return e*=this.options.compressScaleRatio||1,this.os.ios&&this.os.iphone&&(e*=this.options.iphoneFixedRatio||1),e}},{key:"clear",value:function(){for(var t=this.domChildren&&this.domChildren.length||0,i=0;i<t;i+=1)this.container.removeChild(this.domChildren[i]);this.domChildren=null;for(var e=Object.keys(this.events||{}),s=e&&e.length||0,a=0;a<s;a+=1)this.container.removeEventListener(e[a],this.events[e[a]]);this.events=null}},{key:"initCanvas",value:function(){this.canvasFull=document.createElement("canvas"),this.ctxFull=this.canvasFull.getContext("2d"),this.canvasFull.className="clip-canvas-full",this.smoothCtx(this.ctxFull),this.RATIO_PIXEL=this.getPixelRatio(this.ctxFull);var t=this.img.width/this.img.height,i=this.container.offsetWidth||window.innerWidth;this.oldWidth=i,this.oldHeight=i/t,this.resizeCanvas(i,this.oldHeight),this.container.appendChild(this.canvasFull),this.domChildren.push(this.canvasFull)}},{key:"resizeCanvas",value:function(t,i){var e=this.options.maxCssHeight,s=t/i,a=this.oldWidth,h=a/s;e&&h>e&&(a=(h=e)*s),this.marginLeft=(this.oldWidth-a)/2,this.canvasFull.style.width=a+"px",this.canvasFull.style.height=h+"px",this.canvasFull.style.marginLeft=this.marginLeft+"px",this.canvasFull.width=a*this.RATIO_PIXEL,this.canvasFull.height=h*this.RATIO_PIXEL,1&this.rotateStep?this.scale=this.canvasFull.width/this.img.height:this.scale=this.canvasFull.width/this.img.width}},{key:"initClip",value:function(){var t=document.createElement("div");t.className="clip-rect",this.clipRect=t,this.container.appendChild(this.clipRect),this.domChildren.push(this.clipRect);var i=document.createElement("span");i.className="clip-tips",this.clipRect.appendChild(i),this.clipTips=i,-1!==this.options.sizeTipsStyle&&0!==this.options.sizeTipsStyle||this.clipTips.classList.add("clip-hidden"),this.clipRectHorns=[];for(var e=0;e<8;e+=1){var s=document.createElement("span");s.className="clip-rect-horn ",0===e?s.className+="horn-nw":1===e?s.className+="horn-ne":2===e?s.className+="horn-sw":3===e?s.className+="horn-se":4===e?s.className+="horn-n":5===e?s.className+="horn-s":6===e?s.className+="horn-w":7===e&&(s.className+="horn-e"),this.clipRect.appendChild(s),this.clipRectHorns.push(s)}this.resizeClip()}},{key:"resizeClip",value:function(){this.listenerHornsResize(),this.listenerRectMove(),this.listenerContainerLeave()}},{key:"listenerHornsResize",value:function(){var t=this;this.clipEventState={};var i=function(i,e){var s=e-t.canvasFull.offsetTop-t.container.offsetTop,a=i-t.canvasFull.offsetLeft-t.container.offsetLeft;return s=Math.min(s,t.canvasFull.offsetHeight),s=Math.max(0,s),a=Math.min(a,t.canvasFull.offsetWidth),a=Math.max(0,a),t.curX=a,t.curY=s,{curX:a,curY:s}};this.getCurXY=i;var e=function(e){if(t.canResizing){e.preventDefault(),e.stopPropagation();var s=t.clipEventState,a=s.evnt.target,h=e.touches?e.touches[0].pageY:e.pageY,n=e.touches?e.touches[0].pageX:e.pageX,o=i(n,h),c=o.curX,r=o.curY,l=void 0,v=void 0,u=void 0,d=void 0;a.classList.contains("horn-nw")?(l=s.width-(c-s.left),v=s.height-(r-s.top),u=c,d=r):a.classList.contains("horn-ne")?(l=c-s.left,v=s.height-(r-s.top),u=s.left,d=r):a.classList.contains("horn-sw")?(l=s.width-(c-s.left),v=r-s.top,u=c,d=s.top):a.classList.contains("horn-se")?(l=c-s.left,v=r-s.top,u=s.left,d=s.top):a.classList.contains("horn-n")?(l=s.width,v=s.height-(r-s.top),u=s.left,d=r):a.classList.contains("horn-s")?(l=s.width,v=r-s.top,u=s.left,d=s.top):a.classList.contains("horn-w")?(l=s.width-(c-s.left),v=s.height,u=c,d=s.top):a.classList.contains("horn-e")&&(l=c-s.left,v=s.height,u=c-l,d=s.top),t.clipRect.style.left=u+t.marginLeft+"px",t.clipRect.style.top=d+"px",t.clipRect.style.width=l+"px",t.clipRect.style.height=v+"px",t.draw()}};this.container.addEventListener("touchmove",e),this.container.addEventListener("mousemove",e),this.events.touchmove=e,this.events.mousemove=e;var s=function(i){t.canResizing=!0,t.canvasMag.classList.remove("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.remove("clip-hidden"),function(i){t.clipEventState.width=t.clipRect.offsetWidth,t.clipEventState.height=t.clipRect.offsetHeight,t.clipEventState.left=t.clipRect.offsetLeft-t.marginLeft,t.clipEventState.top=t.clipRect.offsetTop,t.clipEventState.mouseX=i.touches?i.touches[0].pageX:i.pageX,t.clipEventState.mouseY=i.touches?i.touches[0].pageY:i.pageY,t.clipEventState.evnt=i}(i)},a=function(){t.canResizing=!1,t.canvasMag.classList.add("clip-hidden"),0===t.options.sizeTipsStyle&&t.clipTips.classList.add("clip-hidden")};this.endHronsResize=a;for(var h=0;h<8;h+=1)this.clipRectHorns[h].addEventListener("mousedown",s),this.clipRectHorns[h].addEventListener("touchstart",s),this.clipRectHorns[h].addEventListener("mouseup",a),this.clipRectHorns[h].addEventListener("touchend",a)}},{key:"listenerRectMove",value:function(){var t=this,i=this.clipRect,e=function(e){if(!t.canResizing&&t.canMove){e.preventDefault(),e.stopPropagation();var s=t.options.minMoveDiff,a=e.touches?e.touches[0].pageY:e.pageY,h=e.touches?e.touches[0].pageX:e.pageX,n=h-t.prevRectMouseX,o=a-t.prevRectMouseY;if(n||o){(Math.abs(n)>s||Math.abs(o)>s)&&(t.prevRectMouseX=h,t.prevRectMouseY=a);var c=i.offsetTop+o,r=i.offsetLeft+n;c<0?c=0:c>t.canvasFull.offsetHeight-i.offsetHeight&&(c=t.canvasFull.offsetHeight-i.offsetHeight),r<t.marginLeft?r=t.marginLeft:r>t.canvasFull.offsetWidth-i.offsetWidth+t.marginLeft&&(r=t.canvasFull.offsetWidth-i.offsetWidth+t.marginLeft),t.clipRect.style.left=r+"px",t.clipRect.style.top=c+"px",t.draw()}}};i.addEventListener("touchmove",e),i.addEventListener("mousemove",e);var s=function(i){t.canMove=!0;var e=i.touches?i.touches[0].pageY:i.pageY,s=i.touches?i.touches[0].pageX:i.pageX;t.prevRectMouseX=s,t.prevRectMouseY=e},a=function(){t.canMove=!1};this.endRectMove=a,i.addEventListener("mousedown",s),i.addEventListener("touchstart",s),i.addEventListener("mouseup",a),i.addEventListener("touchend",a)}},{key:"listenerContainerLeave",value:function(){var t=this,i=function(){t.canResizing&&t.endHronsResize(),t.canMove&&t.endRectMove()};this.container.addEventListener("mouseleave",i),this.container.addEventListener("mouseup",i),this.events.mouseleave=i,this.events.mouseup=i}},{key:"draw",value:function(){this.drawMag();var t=this.getRealFinalImgSize(this.clipRect.offsetWidth*this.RATIO_PIXEL,this.clipRect.offsetHeight*this.RATIO_PIXEL),i=t.width,e=t.height;this.clipTips.innerText=i.toFixed(0)+"*"+e.toFixed(0),this.ctxFull.save(),1&this.rotateStep?this.ctxFull.clearRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.clearRect(0,0,this.canvasFull.width,this.canvasFull.height),this.drawImage(),this.drawMask(),this.ctxFull.beginPath();var s=this.getClipRectParams(),a=s.srcX,h=s.srcY,n=s.sWidth,o=s.sHeight;this.ctxFull.rect(a,h,n,o),this.ctxFull.clip(),this.drawImage(),this.ctxFull.restore()}},{key:"getClipRectParams",value:function(){var t=this.clipRect.offsetTop,i=this.clipRect.offsetLeft-this.marginLeft,e=this.clipRect.offsetWidth,s=this.clipRect.offsetHeight,a=i+e,h=t+s,n=i,o=t,c=e,r=s;return 1===this.rotateStep?(n=t,o=this.canvasFull.offsetWidth-a,c=s,r=e):2===this.rotateStep?(n=this.canvasFull.offsetWidth-a,o=this.canvasFull.offsetHeight-h,c=e,r=s):3===this.rotateStep&&(n=this.canvasFull.offsetHeight-h,o=i,c=s,r=e),n*=this.RATIO_PIXEL,o*=this.RATIO_PIXEL,c*=this.RATIO_PIXEL,r*=this.RATIO_PIXEL,{srcX:n,srcY:o,sWidth:c,sHeight:r}}},{key:"getRealCoordinate",value:function(t,i){var e=t,s=i;return 1===this.rotateStep?(e=i,s=this.canvasFull.offsetWidth-t):2===this.rotateStep?(e=this.canvasFull.offsetWidth-t,s=this.canvasFull.offsetHeight-i):3===this.rotateStep&&(e=this.canvasFull.offsetHeight-i,s=t),e*=this.RATIO_PIXEL,s*=this.RATIO_PIXEL,{x:e,y:s}}},{key:"drawImage",value:function(){1&this.rotateStep?this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.drawImage(this.img,0,0,this.img.width,this.img.height,0,0,this.canvasFull.width,this.canvasFull.height)}},{key:"drawMask",value:function(){this.ctxFull.save(),this.ctxFull.fillStyle="rgba(0, 0, 0, 0.3)",1&this.rotateStep?this.ctxFull.fillRect(0,0,this.canvasFull.height,this.canvasFull.width):this.ctxFull.fillRect(0,0,this.canvasFull.width,this.canvasFull.height),this.ctxFull.restore()}},{key:"drawMag",value:function(){var t=this.options.captureRadius,i=this.getRealCoordinate(this.curX,this.curY),e=2*t,s=2*t,a=i.x-t,h=i.y-t;1&this.rotateStep?this.ctxMag.clearRect(0,0,this.canvasMag.height,this.canvasMag.width):this.ctxMag.clearRect(0,0,this.canvasMag.width,this.canvasMag.height);var n=0,o=0;this.os.ios&&(h<0&&(o=this.canvasMag.height/2*Math.abs(h/t),h=0),a<0&&(n=this.canvasMag.width/2*Math.abs(a/t),a=0)),this.ctxMag.drawImage(this.img,a/this.scale,h/this.scale,e/this.scale,s/this.scale,n,o,this.canvasMag.width,this.canvasMag.height);var c=this.canvasMag.width/2,r=this.canvasMag.height/2,l=5*this.RATIO_PIXEL;this.ctxMag.beginPath(),this.ctxMag.moveTo(c-l,r),this.ctxMag.lineTo(c+l,r),this.ctxMag.moveTo(c,r-l),this.ctxMag.lineTo(c,r+l),this.ctxMag.strokeStyle="#de3c50",this.ctxMag.lineWidth=3,this.ctxMag.stroke()}},{key:"initMagnifier",value:function(){this.canvasMag=document.createElement("canvas"),this.canvasMag.className="magnifier clip-hidden",this.ctxMag=this.canvasMag.getContext("2d"),this.smoothCtx(this.ctxMag),this.container.appendChild(this.canvasMag),this.domChildren.push(this.canvasMag),this.canvasMag.width=2*this.options.captureRadius*this.RATIO_PIXEL,this.canvasMag.height=2*this.options.captureRadius*this.RATIO_PIXEL}},{key:"initTransferCanvas",value:function(){this.canvasTransfer=document.createElement("canvas"),this.canvasTransfer.style.display="none",this.canvasTransfer.className="transfer-canvas",this.ctxTransfer=this.canvasTransfer.getContext("2d"),this.smoothCtx(this.ctxTransfer),this.container.appendChild(this.canvasTransfer),this.domChildren.push(this.canvasTransfer)}},{key:"smoothCtx",value:function(t){var i=this.options.isSmooth;t.mozImageSmoothingEnabled=i,t.webkitImageSmoothingEnabled=i,t.msImageSmoothingEnabled=i,t.imageSmoothingEnabled=i}},{key:"getRealFinalImgSize",value:function(t,i){var e=this.canvasFull.width/this.canvasFull.height,s=this.options.maxWidth||0,a=this.options.forceWidth||0,h=this.options.forceHeight||0,n=t,o=i;return 1&this.rotateStep?((this.options.isUseOriginSize||this.canvasFull.width>this.img.height)&&(n=this.img.width*t/this.canvasFull.height,o=this.img.height*i/this.canvasFull.width),s&&this.canvasFull.height>s&&s<this.img.height&&(n=s*t/this.canvasFull.height,o=s/e*i/this.canvasFull.width),a&&(n=a*t/this.canvasFull.height,o=(h||a/e)*i/this.canvasFull.width)):((this.options.isUseOriginSize||this.canvasFull.width>this.img.width)&&(n=this.img.width*t/this.canvasFull.width,o=this.img.height*i/this.canvasFull.height),s&&this.canvasFull.width>s&&s<this.img.width&&(n=s*t/this.canvasFull.width,o=s/e*i/this.canvasFull.height),a&&(n=a*t/this.canvasFull.width,o=(h||a/e)*i/this.canvasFull.height)),{width:n,height:o}}},{key:"clip",value:function(){var t=this.getClipRectParams(),i=t.srcX,e=t.srcY,s=t.sWidth,a=t.sHeight,h=this.getRealFinalImgSize(s,a),n=h.width,o=h.height;this.rotateStep=this.rotateStep||0;var c=90*this.rotateStep*Math.PI/180;0===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=o):1===this.rotateStep?(this.canvasTransfer.width=o,this.canvasTransfer.height=n,this.ctxTransfer.rotate(c),this.ctxTransfer.translate(0,-this.canvasTransfer.width)):2===this.rotateStep?(this.canvasTransfer.width=n,this.canvasTransfer.height=o,this.ctxTransfer.rotate(c),this.ctxTransfer.translate(-this.canvasTransfer.width,-this.canvasTransfer.height)):3===this.rotateStep&&(this.canvasTransfer.width=o,this.canvasTransfer.height=n,this.ctxTransfer.rotate(c),this.ctxTransfer.translate(-this.canvasTransfer.height,0)),1&this.rotateStep?this.ctxTransfer.drawImage(this.img,i/this.scale,e/this.scale,s/this.scale,a/this.scale,0,0,this.canvasTransfer.height,this.canvasTransfer.width):this.ctxTransfer.drawImage(this.img,i/this.scale,e/this.scale,s/this.scale,a/this.scale,0,0,this.canvasTransfer.width,this.canvasTransfer.height),this.clipImgData=this.canvasTransfer.toDataURL(this.options.mime,this.options.quality)}},{key:"resetClipRect",value:function(){this.clipRect.style.left=(this.marginLeft||0)+"px",this.clipRect.style.top=0,this.clipRect.style.width=this.canvasFull.width/this.RATIO_PIXEL+"px",this.clipRect.style.height=this.canvasFull.height/this.RATIO_PIXEL+"px",this.draw()}},{key:"getClipImgData",value:function(){return this.clipImgData}},{key:"rotate",value:function(t){var i=this.oldWidth,e=this.oldHeight;this.rotateStep=this.rotateStep||0,this.rotateStep+=t?1:-1,this.rotateStep>3?this.rotateStep=0:this.rotateStep<0&&(this.rotateStep=3);var s=90*this.rotateStep*Math.PI/180;this.canvasMag.width=this.canvasMag.width,this.canvasMag.height=this.canvasMag.height,0===this.rotateStep?this.resizeCanvas(i,e):1===this.rotateStep?(this.resizeCanvas(e,i),this.ctxFull.rotate(s),this.ctxFull.translate(0,-this.canvasFull.width),this.ctxMag.rotate(s),this.ctxMag.translate(0,-this.canvasMag.width)):2===this.rotateStep?(this.resizeCanvas(i,e),this.ctxFull.rotate(s),this.ctxFull.translate(-this.canvasFull.width,-this.canvasFull.height),this.ctxMag.rotate(s),this.ctxMag.translate(-this.canvasMag.width,-this.canvasMag.height)):3===this.rotateStep&&(this.resizeCanvas(e,i),this.ctxFull.rotate(s),this.ctxFull.translate(-this.canvasFull.height,0),this.ctxMag.rotate(s),this.ctxMag.translate(-this.canvasMag.height,0)),this.resetClipRect()}},{key:"destroy",value:function(){this.clear(),this.canvasFull=null,this.ctxFull=null,this.canvasTransfer=null,this.ctxTransfer=null,this.canvasMag=null,this.ctxMag=null,this.clipRect=null}}]),i}(),u=void 0,d=void 0,g=void 0,f=void 0,p=void 0,m=void 0,w=void 0,R=void 0,x=void 0,M=void 0,F=void 0,S=void 0,T=void 0,y=void 0,L=void 0,I=void 0,E=function(t,i,e,s,a,h){var n=s,o=a;n>=e?n=e-1:n<0&&(n=0),o>=i?o=i-1:o<0&&(o=0);var c=n*i+o;return c*=4,t[c+h]},C=function(t){var i=t;return i=Math.min(255,i),i=Math.max(0,i)},k=function(t){var i=t;u=i[1][1],d=-.5*i[1][0]+.5*i[1][2],g=i[1][0]-2.5*i[1][1]+2*i[1][2]-.5*i[1][3],f=-.5*i[1][0]+1.5*i[1][1]-1.5*i[1][2]+.5*i[1][3],p=-.5*i[0][1]+.5*i[2][1],m=.25*i[0][0]-.25*i[0][2]-.25*i[2][0]+.25*i[2][2],w=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+.5*i[2][0]-1.25*i[2][1]+i[2][2]-.25*i[2][3],R=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.25*i[2][0]+.75*i[2][1]-.75*i[2][2]+.25*i[2][3],x=i[0][1]-2.5*i[1][1]+2*i[2][1]-.5*i[3][1],M=-.5*i[0][0]+.5*i[0][2]+1.25*i[1][0]-1.25*i[1][2]-i[2][0]+i[2][2]+.25*i[3][0]-.25*i[3][2],F=i[0][0]-2.5*i[0][1]+2*i[0][2]-.5*i[0][3]-2.5*i[1][0]+6.25*i[1][1]-5*i[1][2]+1.25*i[1][3]+2*i[2][0]-5*i[2][1]+4*i[2][2]-i[2][3]-.5*i[3][0]+1.25*i[3][1]-i[3][2]+.25*i[3][3],S=-.5*i[0][0]+1.5*i[0][1]-1.5*i[0][2]+.5*i[0][3]+1.25*i[1][0]-3.75*i[1][1]+3.75*i[1][2]-1.25*i[1][3]-i[2][0]+3*i[2][1]-3*i[2][2]+i[2][3]+.25*i[3][0]-.75*i[3][1]+.75*i[3][2]-.25*i[3][3],T=-.5*i[0][1]+1.5*i[1][1]-1.5*i[2][1]+.5*i[3][1],y=.25*i[0][0]-.25*i[0][2]-.75*i[1][0]+.75*i[1][2]+.75*i[2][0]-.75*i[2][2]-.25*i[3][0]+.25*i[3][2],L=-.5*i[0][0]+1.25*i[0][1]-i[0][2]+.25*i[0][3]+1.5*i[1][0]-3.75*i[1][1]+3*i[1][2]-.75*i[1][3]-1.5*i[2][0]+3.75*i[2][1]-3*i[2][2]+.75*i[2][3]+.5*i[3][0]-1.25*i[3][1]+i[3][2]-.25*i[3][3],I=.25*i[0][0]-.75*i[0][1]+.75*i[0][2]-.25*i[0][3]-.75*i[1][0]+2.25*i[1][1]-2.25*i[1][2]+.75*i[1][3]+.75*i[2][0]-2.25*i[2][1]+2.25*i[2][2]-.75*i[2][3]-.25*i[3][0]+.75*i[3][1]-.75*i[3][2]+.25*i[3][3]},P=function(t,i){var e=t*t,s=i*i,a=s*i;return u+d*i+g*s+f*a+(p+m*i+w*s+R*a)*t+(x+M*i+F*s+S*a)*e+(T+y*i+L*s+I*a)*(e*t)},X=-1,H={width:80,height:80,mime:"image/png",processType:1},z={quality:.92,mime:"image/jpeg",compressScaleRatio:1,iphoneFixedRatio:1.5,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0},W={};return function(e){var h=e;h.scaleImageData=function(e,h,n){(0,[i,s,a,c][t({},H,n).processType])(e,h)},h.scaleImage=function(i,e){var s=i.width,a=i.height,n=t({},H,e),o=document.createElement("canvas"),c=o.getContext("2d");o.width=s,o.height=a,c.drawImage(i,0,0,s,a);var r=c.getImageData(0,0,s,a),l=c.createImageData(n.width,n.height);return h.scaleImageData(r,l,n),o.width=l.width,o.height=l.height,c.putImageData(l,0,0,0,0,o.width,o.height),o.toDataURL(n.mime,.9)},h.compressImage=function(i,e){var s=i.width,a=i.height,h=s/a,n=t({},z,e),o=document.createElement("canvas"),c=o.getContext("2d"),r=function(t){var i=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/i}(c);r*=n.compressScaleRatio||1,navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)&&(r*=n.iphoneFixedRatio||1);var l=window.innerWidth*r;(n.isUseOriginSize||l>s)&&(l=s);var v=n.maxWidth;v&&s>v&&l>v&&(l=v);var u=n.forceWidth,d=n.forceHeight;u&&(l=u);var g=l/h;return d&&(g=d),o.width=l,o.height=g,c.drawImage(i,0,0,s,a,0,0,o.width,o.height),o.toDataURL(n.mime,n.quality)}}(W),W.ImgClip=v,W});